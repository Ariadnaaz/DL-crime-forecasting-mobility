# -*- coding: utf-8 -*-
"""1.Generate_selected_crimes_datasets.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1e0k3ey42xvS70ck1Bmh0a7JiKV5__FKd
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

import warnings
warnings.filterwarnings('ignore')

from google.colab import drive
drive.mount('/content/drive')

"""## Select only the 6 crime types and make naming compatible for all 5 cities

### 1. Baltimore
"""

city_folder = 'Baltimore'

# load dataset clean
df_clean = pd.read_csv(f'drive/MyDrive/PhD_thesis/Crime_data/Preprocessing_raw_data_per_city/{city_folder}/{city_folder}_crimes_clean_all_5ys.csv',low_memory=False,index_col=0)
print("Shape clean dataset: ", df_clean.shape)

# get list of crime categories
group = df_clean['crime_type'].unique().tolist()
print(group)

list_crimes = ['AGG. ASSAULT','COMMON ASSAULT','AUTO THEFT','BURGLARY','HOMICIDE','ROBBERY']

# keep only rows with those 6 crimes
df_filtered = df_clean.copy()
df_filtered = df_filtered[df_filtered['crime_type'].isin(list_crimes)]
print("Shape after selecting the 5 types of crimes: ", df_filtered.shape)

# make naming consistent
df_filtered['crime_type'].replace("AUTO THEFT","Motor Vehicle Theft",inplace=True)
df_filtered['crime_type'].replace("AGG. ASSAULT","Assault",inplace=True)
df_filtered['crime_type'].replace("COMMON ASSAULT","Assault",inplace=True)
df_filtered['crime_type'] = df_filtered['crime_type'].str.title()


# save final dataset
df_filtered.to_csv(f'drive/MyDrive/PhD_thesis/Crime_data/Crime_data_outputs/5_years/{city_folder}_selected_crimes_clean_all.csv')
print("Saved dataset")
print(df_filtered['crime_type'].unique().tolist())

"""### 2. Chicago"""

city_folder = 'Chicago'

# load dataset clean
df_clean = pd.read_csv(f'drive/MyDrive/PhD_thesis/Crime_data/Preprocessing_raw_data_per_city/{city_folder}/{city_folder}_crimes_clean_all_5ys.csv',low_memory=False,index_col=0)
print("Shape clean dataset: ", df_clean.shape)

# get list of crime categories
group = df_clean['crime_type'].unique().tolist()
print(group)

list_crimes = ['ASSAULT','MOTOR VEHICLE THEFT','BURGLARY','HOMICIDE','ROBBERY']

# keep only rows with those 6 crimes
df_filtered = df_clean.copy()
df_filtered = df_filtered[df_filtered['crime_type'].isin(list_crimes)]
print("Shape after selecting the 5 types of crimes: ", df_filtered.shape)

# make naming consistent
df_filtered['crime_type'] = df_filtered['crime_type'].str.title()

# save final dataset
df_filtered.to_csv(f'drive/MyDrive/PhD_thesis/Crime_data/Crime_data_outputs/5_years/{city_folder}_selected_crimes_clean_all.csv')
print("Saved dataset")
print(df_filtered['crime_type'].unique().tolist())

"""### 3. Los Angeles"""

city_folder = 'Los_Angeles'

# load dataset clean
df_clean = pd.read_csv(f'drive/MyDrive/PhD_thesis/Crime_data/Preprocessing_raw_data_per_city/{city_folder}/{city_folder}_crimes_clean_all_5ys.csv',low_memory=False,index_col=0)
print("Shape clean dataset: ", df_clean.shape)

# get list of crime categories
group = df_clean['crime_type'].unique().tolist()
print(group)

list_crimes = ['VEHICLE - STOLEN','BURGLARY','ASSAULT WITH DEADLY WEAPON, AGGRAVATED ASSAULT','INTIMATE PARTNER - AGGRAVATED ASSAULT','INTIMATE PARTNER - SIMPLE ASSAULT','BATTERY - SIMPLE ASSAULT','CHILD ABUSE (PHYSICAL) - SIMPLE ASSAULT','CHILD ABUSE (PHYSICAL) - AGGRAVATED ASSAULT','ROBBERY','ASSAULT WITH DEADLY WEAPON ON POLICE OFFICER','CRIMINAL HOMICIDE','MANSLAUGHTER, NEGLIGENT']

# keep only rows with those 6 crimes
df_filtered = df_clean.copy()
df_filtered = df_filtered[df_filtered['crime_type'].isin(list_crimes)]
print("Shape after selecting the 5 types of crimes: ", df_filtered.shape)

# make naming consistent
assault_list = '|'.join(['ASSAULT WITH DEADLY WEAPON, AGGRAVATED ASSAULT','INTIMATE PARTNER - AGGRAVATED ASSAULT','INTIMATE PARTNER - SIMPLE ASSAULT','BATTERY - SIMPLE ASSAULT','CHILD ABUSE (PHYSICAL) - SIMPLE ASSAULT','CHILD ABUSE (PHYSICAL) - AGGRAVATED ASSAULT','ASSAULT WITH DEADLY WEAPON ON POLICE OFFICER'])
homicide_list = '|'.join(['CRIMINAL HOMICIDE','MANSLAUGHTER, NEGLIGENT'])
df_filtered['crime_type'] = df_filtered['crime_type'].str.replace(assault_list,"Assault",regex=True)
df_filtered['crime_type'] = df_filtered['crime_type'].str.replace(homicide_list,"Homicide",regex=True)
df_filtered['crime_type'].replace("VEHICLE - STOLEN","Motor Vehicle Theft",inplace=True)
df_filtered['crime_type'] = df_filtered['crime_type'].str.title() # converting each string to title case
df_filtered['crime_type'].replace('Child Abuse (Physical) - Simple Assault',"Assault",inplace=True)
df_filtered['crime_type'].replace('Child Abuse (Physical) - Aggravated Assault',"Assault",inplace=True)

# save final dataset
df_filtered.to_csv(f'drive/MyDrive/PhD_thesis/Crime_data/Crime_data_outputs/5_years/{city_folder}_selected_crimes_clean_all.csv')
print("Saved dataset")
print(df_filtered['crime_type'].unique().tolist())

"""### 4. Philadelphia"""

city_folder = 'Philadelphia'

# load dataset clean
df_clean = pd.read_csv(f'drive/MyDrive/PhD_thesis/Crime_data/Preprocessing_raw_data_per_city/{city_folder}/{city_folder}_crimes_clean_all_5ys.csv',low_memory=False,index_col=0)
print("Shape clean dataset: ", df_clean.shape)

# get list of crime categories
group = df_clean['crime_type'].unique().tolist()
print(group)

list_crimes = ['Burglary Non-Residential', 'Aggravated Assault No Firearm', 'Aggravated Assault Firearm', 'Burglary Residential', 'Robbery No Firearm', 'Robbery Firearm', 'Other Assaults','Motor Vehicle Theft', 'Homicide - Criminal ', 'Homicide - Criminal', 'Homicide - Justifiable ', 'Homicide - Gross Negligence']

# keep only rows with those 5 crimes
df_filtered = df_clean.copy()
df_filtered = df_filtered[df_filtered['crime_type'].isin(list_crimes)]
print("Shape after selecting the 5 types of crimes: ", df_filtered.shape)

# make naming consistent
assault_list = '|'.join([ 'Aggravated Assault No Firearm', 'Aggravated Assault Firearm','Other Assaults'])
homicide_list = '|'.join(['Homicide - Criminal ', 'Homicide - Criminal', 'Homicide - Justifiable ','Homicide - Justifiable', 'Homicide - Gross Negligence'])
burglary_list = '|'.join(['Burglary Non-Residential','Burglary Residential'])
robbery_list = '|'.join(['Robbery No Firearm','Robbery Firearm'])
df_filtered['crime_type'] = df_filtered['crime_type'].str.replace(assault_list,"Assault",regex=True)
df_filtered['crime_type'] = df_filtered['crime_type'].str.replace(homicide_list,"Homicide",regex=True)
df_filtered['crime_type'] = df_filtered['crime_type'].str.replace(burglary_list,"Burglary",regex=True)
df_filtered['crime_type'] = df_filtered['crime_type'].str.replace(robbery_list,"Robbery",regex=True)
df_filtered['crime_type'] = df_filtered['crime_type'].str.title()

# save final dataset
df_filtered.to_csv(f'drive/MyDrive/PhD_thesis/Crime_data/Crime_data_outputs/5_years/{city_folder}_selected_crimes_clean_all.csv')
print("Saved dataset")
print(df_filtered['crime_type'].unique().tolist())

"""### 5. San Francisco"""

city_folder = 'San_Francisco'

# load dataset clean
df_clean = pd.read_csv(f'drive/MyDrive/Crime_data/Preprocessing_raw_data_per_city/{city_folder}/{city_folder}_crimes_clean_all.csv',low_memory=False,index_col=0)
print("Shape clean dataset: ", df_clean.shape)

# get list of crime categories
group = df_clean['crime_type'].unique().tolist()
print(group)

list_crimes = ['Assault','Robbery', 'Burglary', 'Motor Vehicle Theft','Motor Vehicle Theft?','Homicide']

# keep only rows with those 5 crimes
df_filtered = df_clean.copy()
df_filtered = df_filtered[df_filtered['crime_type'].isin(list_crimes)]
print("Shape after selecting the 5 types of crimes: ", df_filtered.shape)

# make naming consistent
df_filtered['crime_type'].replace('Motor Vehicle Theft?',"Motor Vehicle Theft",inplace=True)
df_filtered['crime_type'] = df_filtered['crime_type'].str.title()

# save final dataset
df_filtered.to_csv(f'drive/MyDrive/Crime_data/Crime_data_Major/{city_folder}_selected_crimes_clean_all.csv')
print("Saved dataset")
print(df_filtered['crime_type'].unique().tolist())

"""## Get general information selected crimes datasets"""

def crime_types_percentages(city_folder):
  df_crimes = pd.read_csv(f'drive/MyDrive/PhD_thesis/Crime_data/Crime_data_outputs/5_years/{city_folder}_selected_crimes_clean_all.csv',low_memory=False,index_col=0)
  print("Total number of crime incidents: ", df_crimes.shape)

  crimes = df_crimes.groupby(df_crimes['crime_type'].tolist(),as_index=False).size()
  crimes['percentage'] = crimes['size'].apply(lambda x: 100 * x / df_crimes.shape[0])
  print(crimes)

crime_types_percentages(city_folder = 'Baltimore')

crime_types_percentages(city_folder = 'Chicago')

crime_types_percentages(city_folder = 'Los_Angeles')

crime_types_percentages(city_folder = 'Philadelphia')